(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{146:function(e,a,o){"use strict";o.r(a),o.d(a,"frontMatter",(function(){return s})),o.d(a,"metadata",(function(){return i})),o.d(a,"toc",(function(){return c})),o.d(a,"default",(function(){return m}));var t=o(3),n=o(7),r=(o(0),o(153)),s={id:"conector",title:"Conector",sidebar_label:"Conector"},i={unversionedId:"conector",id:"conector",isDocsHomePage:!1,title:"Conector",description:"Conector \xe9 o nome dado \xe0 solu\xe7\xe3o tecnol\xf3gica que acessa a RNDS. \xc9 este software que precisa ser desenvolvido pelo integrador e, de fato, o que implementa a troca de informa\xe7\xe3o em sa\xfade com a RNDS. Por exemplo, no contexto de um laboratorio, faz parte das fun\xe7\xf5es do Conector enviar o resultado de um exame laboratorial para a RNDS.",source:"@site/docs\\conector.md",slug:"/conector",permalink:"/rnds/docs/conector",version:"current",lastUpdatedAt:1612452386,sidebar_label:"Conector",sidebar:"someSidebar",previous:{title:"Introdu\xe7\xe3o",permalink:"/rnds/docs/introducao"},next:{title:"P\xfablico-alvo",permalink:"/rnds/docs/publico-alvo/publico-alvo"}},c=[{value:"Sistema de Informa\xe7\xe3o em Sa\xfade (SIS)",id:"sistema-de-informa\xe7\xe3o-em-sa\xfade-sis",children:[{value:"Sem integra\xe7\xe3o",id:"sem-integra\xe7\xe3o",children:[]},{value:"Com integra\xe7\xe3o",id:"com-integra\xe7\xe3o",children:[]},{value:"<em>Design</em> do Conector (sem restri\xe7\xf5es)",id:"design-do-conector-sem-restri\xe7\xf5es",children:[]}]},{value:"Conector de refer\xeancia",id:"conector-de-refer\xeancia",children:[{value:"Escopo",id:"escopo",children:[]}]},{value:"Requisitos",id:"requisitos",children:[{value:"Obter token de acesso",id:"obter-token-de-acesso",children:[]},{value:"Enviar resultado de exame",id:"enviar-resultado-de-exame",children:[]}]},{value:"Design",id:"design",children:[{value:"Esbo\xe7o inicial",id:"esbo\xe7o-inicial",children:[]},{value:"Esbo\xe7o resultante",id:"esbo\xe7o-resultante",children:[]}]},{value:"Implementa\xe7\xe3o",id:"implementa\xe7\xe3o",children:[{value:"conector-cliente (aws)",id:"conector-cliente-aws",children:[]},{value:"conector-cliente (arquivo)",id:"conector-cliente-arquivo",children:[]},{value:"rnds (biblioteca)",id:"rnds-biblioteca",children:[]},{value:"Fun\xe7\xf5es principais",id:"fun\xe7\xf5es-principais",children:[]}]}],d={toc:c};function m(e){var a=e.components,s=Object(n.a)(e,["components"]);return Object(r.b)("wrapper",Object(t.a)({},d,s,{components:a,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Conector \xe9 o nome dado \xe0 solu\xe7\xe3o tecnol\xf3gica que acessa a RNDS. \xc9 este software que precisa ser desenvolvido pelo integrador e, de fato, o que implementa a troca de informa\xe7\xe3o em sa\xfade com a RNDS. Por exemplo, no contexto de um laboratorio, faz parte das fun\xe7\xf5es do Conector enviar o resultado de um exame laboratorial para a RNDS."),Object(r.b)("p",null,"As se\xe7\xf5es seguintes apresentam quest\xf5es t\xedpicas da integra\xe7\xe3o com a RNDS por meio de um Conector de refer\xeancia, abstrato o suficiente para que possa servir de orienta\xe7\xe3o para v\xe1rios estabelecimentos de sa\xfade interessados em detalhes t\xe9cnicos da integra\xe7\xe3o com a RNDS."),Object(r.b)("h2",{id:"sistema-de-informa\xe7\xe3o-em-sa\xfade-sis"},"Sistema de Informa\xe7\xe3o em Sa\xfade (SIS)"),Object(r.b)("p",null,"Um estabelecimento de sa\xfade usa, em geral, um Sistema de Informa\xe7\xe3o em Sa\xfade (SIS) para auxiliar na gest\xe3o das suas demandas, usu\xe1rios, profissionais de sa\xfade, procedimentos e outros. Tal sistema est\xe1 ou n\xe3o integrado \xe0 RNDS, o que \xe9 ilustrado pelos\ncen\xe1rios abaixo."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(301).default})),Object(r.b)("p",null,"Adicionalmente, pode-se representar abstratamente qualquer SIS como a uni\xe3o de dois componentes: (a) um Banco de Dados, no qual informa\xe7\xf5es administrativas e outras de sa\xfade s\xe3o armazenadas; e (b) o software propriamente dito do SIS."),Object(r.b)("p",null,"Esta organiza\xe7\xe3o abstrada de um SIS em apenas dois componetes \xe9 \xfatil para identificar o que \xe9 denominado de Conector, o que \xe9 feito abaixo por meio dos dois cen\xe1rios ilustrados acima."),Object(r.b)("h3",{id:"sem-integra\xe7\xe3o"},"Sem integra\xe7\xe3o"),Object(r.b)("p",null,"Usando esta abstra\xe7\xe3o, quando n\xe3o h\xe1 interoperabilidade do SIS com outro sistema, n\xe3o h\xe1 software de integra\xe7\xe3o, n\xe3o h\xe1 Conector e, consequentemente, n\xe3o h\xe1 integra\xe7\xe3o com a RNDS, conforme ilustrado abaixo."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(302).default})),Object(r.b)("h3",{id:"com-integra\xe7\xe3o"},"Com integra\xe7\xe3o"),Object(r.b)("p",null,"A integra\xe7\xe3o exige a exist\xeancia do Conector.\nA implementa\xe7\xe3o das fun\xe7\xf5es deste software pode assumir v\xe1rias formas. Duas delas s\xe3o apresentadas abaixo."),Object(r.b)("p",null,"Na primeira, o SIS empregado pelo estabelecimento de sa\xfade passa por uma manuten\xe7\xe3o na qual as fun\xe7\xf5es do Conector s\xe3o fundidas ao SIS existente. O SIS, agora modificado, torna-se um SIS que interage com a RNDS, um SIS integrado \xe0 RNDS."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(303).default})),Object(r.b)("p",null,"Na segunda, um componente espec\xedfico re\xfane e isola as fun\xe7\xf5es necess\xe1rias para a integra\xe7\xe3o com a RNDS, diferente do cen\xe1rio anterior. Neste caso, \xe9 poss\xedvel que o Conector seja encarregado de obter as informa\xe7\xf5es em sa\xfade a serem transferidas, possivelmente acessando diretamente o Banco de Dados do estabelecimento de sa\xfade."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(304).default})),Object(r.b)("h3",{id:"design-do-conector-sem-restri\xe7\xf5es"},Object(r.b)("em",{parentName:"h3"},"Design")," do Conector (sem restri\xe7\xf5es)"),Object(r.b)("p",null,"Conv\xe9m esclarecer que estas duas formas de integra\xe7\xe3o n\xe3o s\xe3o as \xfanicas, e que a RNDS n\xe3o imp\xf5e exig\xeancias na organiza\xe7\xe3o do SIS em quest\xe3o. De fato, nem sequer h\xe1 uma sugest\xe3o de ",Object(r.b)("em",{parentName:"p"},"design")," para o Conector, o que depende de in\xfameras vari\xe1veis espec\xedficas de cada estabelecimento de sa\xfade e, consequentemente, \xe9 assunto interno de cada estabelecimento."),Object(r.b)("h2",{id:"conector-de-refer\xeancia"},"Conector de refer\xeancia"),Object(r.b)("p",null,"Tendo em vista as especificidades de cada integra\xe7\xe3o, \xfanica por estabelecimento de sa\xfade, n\xe3o \xe9 fact\xedvel definir uma an\xe1lise e um ",Object(r.b)("em",{parentName:"p"},"design")," adequados para todos eles. O que segue, portanto, \xe9 uma investiga\xe7\xe3o preliminar com o objetivo de oferecer uma orienta\xe7\xe3o para integradores. A estrat\xe9gia \xe9 familiarizar o integrador com quest\xf5es naturais da integra\xe7\xe3o com a RNDS."),Object(r.b)("h3",{id:"escopo"},"Escopo"),Object(r.b)("p",null,"O Conector, como qualquer outro software, visa atender alguma demanda. Para o Conector de refer\xeancia a demanda (escopo) \xe9 a Portaria 1.792, que determina a obrigatoriedade de notifica\xe7\xe3o de resultados de exame da COVID-19. Conv\xe9m observar que a notifica\xe7\xe3o de laudo de COVID-19 \xe9 a primeira necessidade de troca de informa\xe7\xe3o contemplada pela RNDS."),Object(r.b)("p",null,"Ao longo do tempo, outras necessidades ser\xe3o inclu\xeddas, como a notifica\xe7\xe3o do Sum\xe1rio de Alta (SA) e do Registro de Atendimento Cl\xednico (RAC), por exemplo. Cada necessidade \xe9 detalhada tanto pelo modelo de informa\xe7\xe3o quanto pelo modelo computacional, o que viabiliza a integra\xe7\xe3o com a RNDS para a necessidade em quest\xe3o."),Object(r.b)("p",null,"Naturalmente, \xe0 medida que novas necessidades de integra\xe7\xe3o forem implementadas pela RNDS, mais informa\xe7\xf5es em sa\xfade e outros tipos de estabelecimentos de sa\xfade estar\xe3o envolvidos."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(305).default})),Object(r.b)("p",null,"Apesar do Conector de refer\xeancia atender uma necessidade espec\xedfica (notificar laudos de COVID-19), a discuss\xe3o do mesmo permanece relevante para outras demandas."),Object(r.b)("h2",{id:"requisitos"},"Requisitos"),Object(r.b)("p",null,"A integra\xe7\xe3o, no escopo identificado acima, possui dois casos de uso principais: ",Object(r.b)("em",{parentName:"p"},"Obter token de acesso")," e ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame"),"."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(306).default})),Object(r.b)("p",null,'Um Conector pode envolver outras fun\xe7\xf5es. Por exemplo, responder se um determinado resultado foi submetido satisfatoriamente ou n\xe3o e recuperar a resposta da RNDS para uma dada notifica\xe7\xe3o entregue s\xe3o algumas das possibilidades. Estas fun\xe7\xf5es s\xe3o possivelmente necess\xe1rias, mas ao mesmo tempo "gen\xe9ricas", n\xe3o s\xe3o espec\xedficas da integra\xe7\xe3o com a RNDS. Em consequ\xeancia, apenas os casos de uso citados acima s\xe3o considerados.'),Object(r.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Nota")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Compreender os casos de uso ",Object(r.b)("em",{parentName:"p"},"Obter token de acesso")," e ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame")," significa compreender o que \xe9 relevante para qualquer integra\xe7\xe3o com a RNDS, e n\xe3o apenas para a notifica\xe7\xe3o de resultado do COVID-19. Eles representam a seguran\xe7a e uma necessidade de interoperabilidade em sa\xfade, respectivamente."))),Object(r.b)("h3",{id:"obter-token-de-acesso"},"Obter token de acesso"),Object(r.b)("p",null,"A obten\xe7\xe3o de um ",Object(r.b)("em",{parentName:"p"},"token")," de acesso \xe9 necess\xe1ria para identificar o estabelecimento de sa\xfade e verificar se o mesmo possui acesso aos servi\xe7os que ir\xe1 requisitar \xe0 RNDS. Esta fun\xe7\xe3o, portanto, \xe9 exclusivamente para seguran\xe7a."),Object(r.b)("p",null,"Ser\xe1 necess\xe1rio o certificado digital (e-CPF ou e-CNPJ) associado ao estabelecimento de sa\xfade e a senha de acesso ao certificado. Estas duas informa\xe7\xf5es ser\xe3o empregadas para\nefetuar uma requisi\xe7\xe3o ",Object(r.b)("em",{parentName:"p"},"https")," que, se executada satisfatoriamente, dever\xe1 retornar um objeto JSON como aquele abaixo."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "longa sequ\xeancia de caracteres",\n  "scope": "read write",\n  "token_type": "jwt",\n  "expires_in": 1800000\n}\n')),Object(r.b)("p",null,"O que interessa \xe9 o valor para ",Object(r.b)("inlineCode",{parentName:"p"},"access_token"),", uma sequ\xeancia\nde mais de 2K caracteres. Outro valor retornado \xe9 o tempo\nde validade deste ",Object(r.b)("em",{parentName:"p"},"token"),", neste caso, 30min, ou 1.800.000ms. A expectativa \xe9 de que o Conector s\xf3 realize uma requisi\xe7\xe3o para obter ",Object(r.b)("em",{parentName:"p"},"token")," de acesso cerca de 30 minutos ap\xf3s a \xfaltima requisi\xe7\xe3o. Neste intervalo, o Conector deve guardar o valor do ",Object(r.b)("em",{parentName:"p"},"token")," a ser reutilizado, at\xe9 que seja substitu\xeddo por uma nova requisi\xe7\xe3o, cerca de 30 minutos depois."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"IMPORTANTE")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"O Conector deve reutilizar o valor obtido para ",Object(r.b)("inlineCode",{parentName:"p"},"access_token"),"\ndurante o per\xedodo em que ele \xe9 v\xe1lido. Isto significa que\nmuitas requisi\xe7\xf5es aos ",Object(r.b)("em",{parentName:"p"},"web services")," de sa\xfade possivelmente ser\xe3o feitas usando um mesmo valor de ",Object(r.b)("em",{parentName:"p"},"token"),", obtido de uma\n\xfanica requisi\xe7\xe3o para um ",Object(r.b)("em",{parentName:"p"},"web service")," de seguran\xe7a."))),Object(r.b)("p",null,"A obten\xe7\xe3o do ",Object(r.b)("em",{parentName:"p"},"token")," de acesso \xe9 uma forma de autentica\xe7\xe3o\ndo Conector, ou melhor, do estabelecimento de sa\xfade, usando\num certificado digital, uma estrat\xe9gia mais segura que a autentica\xe7\xe3o comum usando o par usu\xe1rio/senha."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Java e JavaScript")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Em ",Object(r.b)("a",{parentName:"p",href:"https://github.com/kyriosdata/rnds"},"https://github.com/kyriosdata/rnds")," encontram-se os\nprojetos ",Object(r.b)("inlineCode",{parentName:"p"},"rnds-java")," e ",Object(r.b)("inlineCode",{parentName:"p"},"rnds-js"),", ambos ilustram como obter\no ",Object(r.b)("em",{parentName:"p"},"token")," de acesso, respectivamente nas linguagens Java e JavaScript."))),Object(r.b)("p",null,'Aos interessados, muita informa\xe7\xe3o pode ser encontrada\nna internet para o assunto "ssl client authentication".'),Object(r.b)("h3",{id:"enviar-resultado-de-exame"},"Enviar resultado de exame"),Object(r.b)("p",null,"Na perspectiva de processos (fun\xe7\xf5es) e do fluxo de informa\xe7\xf5es entre eles, o envio de resultado de exame \xe9 ilustrado abaixo. Aqueles processos coloridos s\xe3o gen\xe9ricos no sentido em que n\xe3o dependem do SIS em quest\xe3o. Os demais dependem diretamente do SIS para o qual o Conector \xe9 criado."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(307).default})),Object(r.b)("p",null,"As fun\xe7\xf5es s\xe3o comentadas abaixo ap\xf3s ressaltar que, dependendo do SIS em quest\xe3o, algumas delas podem n\xe3o ser\nnecess\xe1rias. Por exemplo, se um dado SIS j\xe1 guarda informa\xe7\xf5es sobre cada resultado de exame em documento XML pr\xf3prio, ent\xe3o n\xe3o ser\xe1 necess\xe1rio coletar informa\xe7\xf5es dispersas, filtrar e talvez nem tampouco efetuar algum mapeamento. Ou, se preferir,\nestas fun\xe7\xf5es foram realizadas, mas em momento distinto do\nenvio propriamente dito."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Filtrar dados"),". Seleciona os dados de um resultado de exame contendo o que \xe9 necess\xe1rio para o envio.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Mapear dados"),'. Realiza a convers\xe3o e/ou mapeamento, se for o caso, entre o que \xe9 recuperado (fun\xe7\xe3o acima) e o formato exigido pela RNDS. Por exemplo, a data "01/01/21" \xe9\nmapeada para "01/01/2021".')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Criar inst\xe2ncia de recurso"),". Os dados j\xe1 filtrados e mapeados empregam uma estrutura de dados que precisa ser representada em JSON, em conformidade com o recurso FHIR (",Object(r.b)("em",{parentName:"p"},"resource"),") pertinente.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Montar bundle"),". Empacota os recursos pertinentes na representa\xe7\xe3o JSON de um ",Object(r.b)("em",{parentName:"p"},"Bundle")," (um dos recursos FHIR).\nQuando executada, esta fun\xe7\xe3o tamb\xe9m pode realizar a\nverifica\xe7\xe3o da representa\xe7\xe3o resultante. Ou seja, assegurar\nque foi criada conforme esperado pela RNDS.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Obter token"),". Obt\xe9m ",Object(r.b)("em",{parentName:"p"},"token")," do ",Object(r.b)("em",{parentName:"p"},"web service")," de seguran\xe7a da RNDS para acesso aos demais servi\xe7os.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Submeter requisi\xe7\xe3o"),". Notifica o resultado de um exame \xe0 RNDS. Esta \xe9 a fun\xe7\xe3o que, de fato, realiza o envio desejado, faz uso de um ",Object(r.b)("em",{parentName:"p"},"web service")," com foco na sa\xfade. Observe que este envio depende do ",Object(r.b)("em",{parentName:"p"},"token")," obtido pela fun\xe7\xe3o acima."))),Object(r.b)("p",null,"A figura abaixo ilustra os processos executados em uma sequ\xeancia t\xedpica, al\xe9m do ",Object(r.b)("em",{parentName:"p"},"web service")," de seguran\xe7a e daqueles de sa\xfade oferecidos pela RNDS, identificados respectivamente por ",Object(r.b)("em",{parentName:"p"},"Auth")," e ",Object(r.b)("em",{parentName:"p"},"EHR"),". Em tempo, tais servi\xe7os s\xe3o oferecidos pelos ",Object(r.b)("a",{parentName:"p",href:"rnds/ambientes"},"ambientes")," da RNDS."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(308).default})),Object(r.b)("p",null,"Conv\xe9m esclarecer que a especifica\xe7\xe3o de requisitos de software est\xe1 al\xe9m do alcance deste documento, dado que s\xf3 poderia ser produzida para uma situa\xe7\xe3o espec\xedfica de integra\xe7\xe3o. A boa not\xedcia \xe9 que estaria al\xe9m do necess\xe1rio\npara a forma\xe7\xe3o do integrador."),Object(r.b)("h2",{id:"design"},"Design"),Object(r.b)("p",null,"Os cass de uso podem ser realizadas de v\xe1rias maneiras. Abaixo segue apenas um poss\xedvel ",Object(r.b)("em",{parentName:"p"},"design"),", dado que n\xe3o s\xe3o fornecidos detalhes de uma integra\xe7\xe3o espec\xedfica. Nesta poss\xedvel solu\xe7\xe3o, o Conector \xe9 implementado por um\nmicrosservi\xe7o acionado por evento."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"IMPORTANTE: o emprego de um\nmicrosservi\xe7o visa ilustrar como o Conector pode ser\nimplementado, em algum poss\xedvel cen\xe1rio, e n\xe3o se confunde com uma recomenda\xe7\xe3o.")),Object(r.b)("p",null,"O evento sinaliza a gera\xe7\xe3o de um laudo de exame, conforme ilustrado abaixo. Dessa forma, o\nSIS \xe9 modificado para gerar um evento, e o microsservi\xe7o (Conector)\nnotifica o Minist\xe9rio da Sa\xfade por meio da RNDS."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(309).default})),Object(r.b)("p",null,"O Conector est\xe1 isolado do restante do SIS, \xe9 um microsservi\xe7o. O ",Object(r.b)("em",{parentName:"p"},"design"),' do\nc\xf3digo deste microsservi\xe7o pode ser influenciado por v\xe1rios fatores, quest\xe3o j\xe1 levantada anteriormente, at\xe9 mesmo a forma\xe7\xe3o do integrador e a expectativa de qualidade para o Conector, por exemplo, dentre muitos outros. Ou seja, \xe9 natural existirem alternativas para o que segue, inclusive "melhores" (sugest\xf5es s\xe3o bem-vindas).'),Object(r.b)("p",null,"Considera\xe7\xf5es feitas, a orienta\xe7\xe3o \xe9 um ",Object(r.b)("em",{parentName:"p"},"design")," que privilegie a legibilidade e\na manutenibilidade. Qualquer outra quest\xe3o ser\xe1 secund\xe1ria a estas."),Object(r.b)("p",null,"A vis\xe3o funcional do caso de uso ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame")," inspira o ",Object(r.b)("em",{parentName:"p"},"design"),"."),Object(r.b)("h3",{id:"esbo\xe7o-inicial"},"Esbo\xe7o inicial"),Object(r.b)("p",null,"Em um primeiro esfor\xe7o foram identificadas as classes abaixo. Aquelas n\xe3o coloridas realizam as fun\xe7\xf5es do neg\xf3cio (caso de uso ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame"),"). As demais\noferecem o suporte necess\xe1rio."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(310).default})),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"Conector")," encapsula a conex\xe3o do SIS com o microsservi\xe7o. Desta forma,\na implementa\xe7\xe3o correspondente, por exemplo, se uma requisi\xe7\xe3o ",Object(r.b)("em",{parentName:"p"},"https")," ou o envio\nde uma mensagem por meio de ",Object(r.b)("a",{parentName:"p",href:"https://activemq.apache.org/"},"ActiveMQ")," (",Object(r.b)("em",{parentName:"p"},"message broker"),") ou ",Object(r.b)("a",{parentName:"p",href:"https://aws.amazon.com/sns/"},"SNS"),", fica encapsulada nesta classe.\nEm consequ\xeancia, o c\xf3digo que faz uso desta classe executa uma simples mensagem como\n",Object(r.b)("inlineCode",{parentName:"p"},"Conector.notifique(resultado)"),", por exemplo."),Object(r.b)("p",null,"Este microsservi\xe7o deve possuir o seu pr\xf3prio reposit\xf3rio onde s\xe3o registradas as\nrequisi\xe7\xf5es recebidas e os resultados obtidos das submiss\xf5es. Cada submiss\xe3o re\xfane o que \xe9 submetido, o ",Object(r.b)("inlineCode",{parentName:"p"},"Resultado")," de um exame e a resposta apresentada pela RNDS (para eventual consulta posterior). Talvez um nome melhor\npara o reposit\xf3rio seja ",Object(r.b)("inlineCode",{parentName:"p"},"ConectorRepositry"),", em vez de ",Object(r.b)("inlineCode",{parentName:"p"},"ResultadoRepository"),"."),Object(r.b)("p",null,"O envio propriamente dito de informa\xe7\xe3o para a RNDS est\xe1 encapsulada na classe ",Object(r.b)("inlineCode",{parentName:"p"},"RNDSProxy"),". Este envio depende do ",Object(r.b)("em",{parentName:"p"},"token")," de acesso cuja gest\xe3o pode estar encapsulada\nna classe ",Object(r.b)("inlineCode",{parentName:"p"},"TokenCache"),". Naturalmente, estas fun\xe7\xf5es dependem de valores que variam ao\nlongo do tempo e s\xe3o obtidos, nesta proposta, pela classe ",Object(r.b)("inlineCode",{parentName:"p"},"Configuracao"),". Por exemplo, o certificado digital e a senha correspondente s\xe3o algumas das informa\xe7\xf5es obtidas por meio desta classe."),Object(r.b)("p",null,"As tr\xeas classes comentadas no par\xe1grafo anterior implementam fun\xe7\xf5es de acesso \xe0 RNDS e, naturalmente, devem ser reutilizadas, o que as tornam candidatas a serem transferidas para uma biblioteca. A biblioteca ",Object(r.b)("a",{parentName:"p",href:"https://www.npmjs.com/package/rnds"},"rnds")," \xe9 um exemplo deste ",Object(r.b)("em",{parentName:"p"},"design"),"."),Object(r.b)("p",null,"Em consequ\xeancia, podemos definir duas bibliotecas e nos concentrar, na pr\xf3xima vers\xe3o, apenas no neg\xf3cio ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame"),", e abstrair as fun\xe7\xf5es de suporte."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(311).default})),Object(r.b)("h3",{id:"esbo\xe7o-resultante"},"Esbo\xe7o resultante"),Object(r.b)("p",null,"Tratar as fun\xe7\xf5es (processos) filtrar, mapear e demais como fun\xe7\xe3o (",Object(r.b)("a",{parentName:"p",href:"https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html"},"Function")," em Java) \xe9 um passo natural. Sim, o ",Object(r.b)("em",{parentName:"p"},"design"),", neste caso, sofre influ\xeancia de Java, embora possa ser implementado usando C#, por exemplo, por meio de ",Object(r.b)("em",{parentName:"p"},"delegates"),". Noutras palavras, este\n",Object(r.b)("em",{parentName:"p"},"design")," n\xe3o \xe9 restrito \xe0 Java."),Object(r.b)("p",null,"A figura abaixo refina as classes identificadas anteriormente, cada uma delas com uma\nfun\xe7\xe3o bem-definida, em classe pr\xf3pria, o que promove a coes\xe3o. A combina\xe7\xe3o delas,\nem uma \xfanica linha, conforme ilustrada na figura, sugere que \xe9 uma alternativa a ser considerada para transformar uma ",Object(r.b)("inlineCode",{parentName:"p"},"Resposta")," na representa\xe7\xe3o JSON de um ",Object(r.b)("em",{parentName:"p"},"Bundle")," (recurso FHIR), esperado pela RNDS."),Object(r.b)("p",null,Object(r.b)("img",{alt:"img",src:o(312).default})),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"Filtrar")," implementa a fun\xe7\xe3o de mesmo nome identificada acima. Qualquer\nque seja a estrutura e as informa\xe7\xf5es em ",Object(r.b)("inlineCode",{parentName:"p"},"Resultado"),', o que \xe9 relevante \xe9 depositado em\num dicion\xe1rio com chave pertinente, por exemplo, "cns" para o CNS do usu\xe1rio em quest\xe3o.'),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"Mapear"),' realiza eventuais mapeamentos, por exemplo, o valor "positivo" para o c\xf3digo correspondente esperado pela RNDS e assim por diante.'),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"ToJson")," cria a representa\xe7\xe3o JSON para cada recurso FHIR exigido. Por exemplo, um resultado de exame laboratorial de COVID-19 inclui a amostra biol\xf3gica. O recurso FHIR correspondente \xe9 ",Object(r.b)("a",{parentName:"p",href:"https://www.hl7.org/fhir/specimen.html"},"Specimen"),", a especializa\xe7\xe3o ou adapta\xe7\xe3o nacional deste recurso \xe9 denominada de ",Object(r.b)("a",{parentName:"p",href:"https://simplifier.net/redenacionaldedadosemsaude/BRAmostraBiologica"},"Amostra Biol\xf3gica"),". Portanto, respeitando as restri\xe7\xf5es nacionais, definidas na ",Object(r.b)("a",{parentName:"p",href:"https://simplifier.net/redenacionaldedadosemsaude/BRAmostraBiologica"},"Amostra Biol\xf3gica"),", para o recurso FHIR ",Object(r.b)("a",{parentName:"p",href:"https://www.hl7.org/fhir/specimen.html"},"Specimen"),", ser\xe1 criado o JSON correspondente para o resultado em quest\xe3o, a ser notificado para a RNDS. Se a amostra biol\xf3gica em quest\xe3o \xe9 sangue, ent\xe3o a representa\xe7\xe3o JSON correspondente \xe9 aquela abaixo:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "fullUrl": "urn:uuid:transient-2",\n  "resource": {\n    "resourceType": "Specimen",\n    "meta": {\n      "profile": [\n        "http://www.saude.gov.br/fhir/r4/StructureDefinition/BRAmostraBiologica-1.0"\n      ]\n    },\n    "type": {\n      "coding": [\n        {\n          "system": "http://www.saude.gov.br/fhir/r4/CodeSystem/BRTipoAmostraGAL",\n          "code": "SGHEM"\n        }\n      ]\n    }\n  }\n}\n')),Object(r.b)("p",null,"A representa\xe7\xe3o a ser produzida pela classe ",Object(r.b)("inlineCode",{parentName:"p"},"ToJson")," pode ser realizada de v\xe1rias formas, desde um mapeamento de cada poss\xedvel amostra biol\xf3gica para a estrutura correspondente, at\xe9 o uso de uma API como a HAPI FHIR API, na qual se monta uma\ninst\xe2ncia da classe ",Object(r.b)("inlineCode",{parentName:"p"},"Specimen"),' usando m\xe9todos de "alto n\xedvel" (',Object(r.b)("em",{parentName:"p"},"fluent interface"),"). O objeto resultado pode ser serializado usando recursos da pr\xf3pria API."),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"Empacotar")," recebe os recursos pertinentes ao resultado j\xe1 serializados e os deposita em um ",Object(r.b)("em",{parentName:"p"},"Bundle"),", que possui seus pr\xf3prios atributos, al\xe9m dos recursos que inclui, o que pode ser facilmente visto no JSON abaixo, onde o valor para ",Object(r.b)("inlineCode",{parentName:"p"},"identifier")," e os elementos do vetor ",Object(r.b)("inlineCode",{parentName:"p"},"entry")," foram omitidos por simplicidade."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n   "resourceType":"Bundle",\n   "type":"document",\n   "timestamp":"2020-03-20T00:00:00-03:00",\n   "meta": {\n      "lastUpdated": "2020-03-20T00:00:00-03:00"\n   },\n   "identifier":{ ... omitido ... },\n   "entry":[\n      { ... Resultado de Exame Laboratorial ... },\n      { ... Diagn\xf3stico em Laborat\xf3rio Cl\xednico ... },\n      { ... Amostra Biol\xf3gica ... }\n    ]\n}\n')),Object(r.b)("p",null,"Os coment\xe1rios acima para as classes ",Object(r.b)("inlineCode",{parentName:"p"},"ToJson")," e ",Object(r.b)("inlineCode",{parentName:"p"},"Empacotar")," podem ser complementados\npelo detalhamento dos dados a serem enviados, ou seja, a discuss\xe3o do ",Object(r.b)("a",{parentName:"p",href:"./rel/mc-rel"},"Modelo Computacional")," de um resultado de exame laboratorial."),Object(r.b)("h2",{id:"implementa\xe7\xe3o"},"Implementa\xe7\xe3o"),Object(r.b)("p",null,"O ",Object(r.b)("em",{parentName:"p"},"design")," acima organiza o c\xf3digo, mas n\xe3o imp\xf4e restri\xe7\xf5es ou define detalhes pela aus\xeancia de um cen\xe1rio concreto de um estabelecimento de sa\xfade, conforme discutido abaixo, tanto para as bibliotecas identificadas quanto para as fun\xe7\xf5es princiais."),Object(r.b)("h3",{id:"conector-cliente-aws"},"conector-cliente (aws)"),Object(r.b)("p",null,"A classe ",Object(r.b)("inlineCode",{parentName:"p"},"Conector")," deve encapsular a comunica\xe7\xe3o do SIS com Conector e, conforme destacado, isto pode ser feito de in\xfameras formas."),Object(r.b)("p",null,"Em um cen\xe1rio onde a nuvem da Amazon \xe9 empregada, apenas para exemplificar, o microsservi\xe7o Conector pode ser implementado por uma Lambda Function exposta por meio do servi\xe7o API Gateway. Neste cen\xe1rio, a a implementa\xe7\xe3o do m\xe9todo ",Object(r.b)("inlineCode",{parentName:"p"},"Conector.notificar(Resultado)")," ter\xe1 que fazer requisi\xe7\xf5es ",Object(r.b)("em",{parentName:"p"},"https")," para o ",Object(r.b)("em",{parentName:"p"},"endpoint")," exposto pelo servi\xe7o API Gateway, qe ser\xe3o redirecionadas para a Lambda Function corresondente."),Object(r.b)("h3",{id:"conector-cliente-arquivo"},"conector-cliente (arquivo)"),Object(r.b)("p",null,"Naturalmente, a nuvem da Amazon pode n\xe3o ser uma op\xe7\xe3o e, neste caso, outra estrat\xe9gia pode ser empregada, conforme o que melhor se alinha\nao contexto do estabelecimento de sa\xfade em quest\xe3o. Por exemplo, o cen\xe1rio no qual o laborat\xf3rio n\xe3o emprega um SIS em execu\xe7\xe3o em uma nuvem, mas em\nsua pr\xf3pria infraestrutura."),Object(r.b)("p",null,"Adicionalmente, o SIS j\xe1 oferece recurso para exportar em documento XML,\npor exemplo, um laudo, com esquema bem-definido. Neste cen\xe1rio n\xe3o seria mais aproriado monitorar um diret\xf3rio e a cada arquivo ali depositado, disparar o caso de uso ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame"),"? Observe que o SIS\nexistente, neste cen\xe1rio hipot\xe9tico, n\xe3o necessariamente sofre altera\xe7\xe3o."),Object(r.b)("p",null,"Apenas como informa\xe7\xe3o adicional, a biblioteca ",Object(r.b)("a",{parentName:"p",href:"https://www.npmjs.com/package/chokidar"},"Chokidar"),' tem como foco monitorar arquivos e diret\xf3rios de forma eficiente, conforme sua documenta\xe7\xe3o, e j\xe1 foi baixada mais de 30 milh\xf5es de vezes "nesta semana". Naturalmente \xe9 uma op\xe7\xe3o para implementar, em JavaScript, o que foi atribu\xeddo \xe0 biblioteca ',Object(r.b)("inlineCode",{parentName:"p"},"conector-cliente"),", neste estabelecimento fict\xedcio."),Object(r.b)("h3",{id:"rnds-biblioteca"},"rnds (biblioteca)"),Object(r.b)("p",null,"\xc0s fun\xe7\xf5es atribu\xeddas a esta biblioteca s\xe3o bem espec\xedficas e podem ser encapsuladas, independente do cen\xe1rio do estabelecimento de sa\xfade em quest\xe3o. \xc9 o que \xe9 feito por meio da HAPI FHIR API, dentre outras op\xe7\xf5es como a biblioteca ",Object(r.b)("a",{parentName:"p",href:"https://www.npmjs.com/package/rnds"},"rnds"),"."),Object(r.b)("p",null,"Considera\xe7\xf5es feitas, o caso de uso ",Object(r.b)("em",{parentName:"p"},"Obter token")," est\xe1 implementado, enquanto ",Object(r.b)("em",{parentName:"p"},"Enviar resultado de exame"),", apenas parcialmente, em JavaScript por meio do projeto ",Object(r.b)("a",{parentName:"p",href:"https://www.npmjs.com/package/rnds"},"rnds")," (projeto ",Object(r.b)("em",{parentName:"p"},"open source"),"). Observe que o envio propriamente dito est\xe1 implementado, enquanto as demais fun\xe7\xf5es, filtrar, mapear e outras, tendo em vista a depend\xeancia do contexto de um estabelecimento de sa\xfade real, n\xe3o."),Object(r.b)("h3",{id:"fun\xe7\xf5es-principais"},"Fun\xe7\xf5es principais"),Object(r.b)("p",null,"As estrat\xe9gias adotadas nas bibliotecas acima dificilmente podem ser replicadas aqui na implementa\xe7\xe3o das fun\xe7\xf5es ditas principais, como filtrar e mapear, por exemplo."),Object(r.b)("p",null,"Quando em cen\xe1rio anterior foi dito que um SIS hipot\xe9tico \xe9 capaz de exportar um documento XML pertinente a um resultado de exame, tem-se uma fun\xe7\xe3o \xfatil e que viabiliza o acr\xe9scimo do Conector sem necessidade de altera\xe7\xe3o do SIS. Contudo, o esquema empregado pelo SIS, provavelmente, \xe9 diferente daquele estabelecido pelo modelo computacional e tamb\xe9m pelo informacional correspondente. Em consequ\xeancia, n\xe3o h\xe1 como implementar uma fun\xe7\xe3o ",Object(r.b)("em",{parentName:"p"},"filtrar")," de forma gen\xe9rica, mas espec\xedfica e caso por caso."),Object(r.b)("p",null,"Apesar de n\xe3o ser vi\xe1vel uma implementa\xe7\xe3o que possa ser reutilizada, \xe9 poss\xedvel indicar ferramentas \xfateis aos desenvolvedores, por exemplo,\nque realizam opera\xe7\xf5es sobre documentos XML. Observe que, mesmo neste exemplo, a sugest\xe3o pode n\xe3o se aplicar, pois um formato bin\xe1rio pr\xf3prio pode ser empregado pelo SIS, o que torna a indica\xe7\xe3o pertinente \xe0 XML irrelevante."))}m.isMDXComponent=!0},153:function(e,a,o){"use strict";o.d(a,"a",(function(){return p})),o.d(a,"b",(function(){return b}));var t=o(0),n=o.n(t);function r(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function s(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?s(Object(o),!0).forEach((function(a){r(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function c(e,a){if(null==e)return{};var o,t,n=function(e,a){if(null==e)return{};var o,t,n={},r=Object.keys(e);for(t=0;t<r.length;t++)o=r[t],a.indexOf(o)>=0||(n[o]=e[o]);return n}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)o=r[t],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var d=n.a.createContext({}),m=function(e){var a=n.a.useContext(d),o=a;return e&&(o="function"==typeof e?e(a):i(i({},a),e)),o},p=function(e){var a=m(e.components);return n.a.createElement(d.Provider,{value:a},e.children)},l={inlineCode:"code",wrapper:function(e){var a=e.children;return n.a.createElement(n.a.Fragment,{},a)}},u=n.a.forwardRef((function(e,a){var o=e.components,t=e.mdxType,r=e.originalType,s=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=m(o),u=t,b=p["".concat(s,".").concat(u)]||p[u]||l[u]||r;return o?n.a.createElement(b,i(i({ref:a},d),{},{components:o})):n.a.createElement(b,i({ref:a},d))}));function b(e,a){var o=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=o.length,s=new Array(r);s[0]=u;var i={};for(var c in a)hasOwnProperty.call(a,c)&&(i[c]=a[c]);i.originalType=e,i.mdxType="string"==typeof e?e:t,s[1]=i;for(var d=2;d<r;d++)s[d]=o[d];return n.a.createElement.apply(null,s)}return n.a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},301:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/cenarios-9844131e1f337994115f112e4ca00e26.png"},302:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-m0-c8a4d85968e74b306ce21426e7bd8f59.png"},303:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-m1-e19e25d72401182dc7c556e3c4c39b64.png"},304:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-m2-2661ffa2db54833a49857e1e16e127fc.png"},305:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-percurso-a54edb82e15fa3898b12751b4431e759.png"},306:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-uc-6ba1956ef96ffc7c1b47c5c0c557672b.png"},307:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-dfd-65b559a17aeb27622bfb54fb86950da4.png"},308:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/desenvolvedor-9a5d747dfa95143512fe6021317e9e23.png"},309:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/rnds-m3-2068260764a8e528e9f07eeabe85a72b.png"},310:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/conector-domain-v0-de2924ddb5e16c2cab25501a5d9f23ac.png"},311:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/conector-bibliotecas-bf741d17a61a01f414f9cd09ef6e318a.png"},312:function(e,a,o){"use strict";o.r(a),a.default=o.p+"assets/images/conector-domain-v1-36743b3f61b34044ae048c1e7f9d643e.png"}}]);